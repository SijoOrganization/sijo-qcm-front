<div class="admin-dashboard">
  <!-- Header -->
  <div class="admin-header">
    <div class="container-fluid">
      <h1 class="admin-title">
        <i class="fas fa-cogs me-3"></i>
        Administration Dashboard
      </h1>
      <nav class="admin-nav">
        <button 
          class="nav-btn" 
          [class.active]="currentTab() === 'dashboard'"
          (click)="switchTab('dashboard')"
        >
          <i class="fas fa-tachometer-alt"></i>
          Dashboard
        </button>
        <button 
          class="nav-btn" 
          [class.active]="currentTab() === 'ai-generator'"
          (click)="switchTab('ai-generator')"
        >
          <i class="fas fa-robot"></i>
          AI Quiz Generator
        </button>
        <button 
          class="nav-btn" 
          [class.active]="currentTab() === 'validation'"
          (click)="switchTab('validation')"
        >
          <i class="fas fa-check-circle"></i>
          Quiz Validation
        </button>
        <button 
          class="nav-btn" 
          [class.active]="currentTab() === 'candidates'"
          (click)="switchTab('candidates')"
        >
          <i class="fas fa-users"></i>
          Candidates
        </button>
        <button 
          class="nav-btn" 
          [class.active]="currentTab() === 'analytics'"
          (click)="switchTab('analytics')"
        >
          <i class="fas fa-chart-bar"></i>
          Analytics
        </button>
      </nav>
    </div>
  </div>

  <!-- AI Generator Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'ai-generator'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-robot me-2"></i>
              AI Quiz Generator
            </h5>
            <p class="text-muted mb-0">Generate quizzes using AI - All generated quizzes require validation before being available to candidates</p>
          </div>
          <div class="card-body">
            <app-ai-quiz-generator></app-ai-quiz-generator>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz Validation Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'validation'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-check-circle me-2"></i>
              Quiz Validation Center
            </h5>
            <p class="text-muted mb-0">Review and validate AI-generated quizzes before they become available to candidates</p>
          </div>
          <div class="card-body">
            <!-- Pending Quizzes Section -->
            <div class="mb-4" *ngIf="pendingQuizzes().length > 0">
              <h6 class="text-warning">
                <i class="fas fa-clock me-2"></i>
                Pending Validation ({{ pendingQuizzes().length }})
              </h6>
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                These quizzes were generated by AI and need your review before being available to candidates.
              </div>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Topics</th>
                      <th>Questions</th>
                      <th>Difficulty</th>
                      <th>Generated</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let quiz of pendingQuizzes()">
                      <td>
                        <div class="d-flex align-items-center">
                          <i class="fas fa-robot text-primary me-2"></i>
                          {{ quiz.title }}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-secondary">{{ quiz.category }}</span>
                      </td>
                      <td>
                        <span class="badge bg-info">{{ quiz.questions?.length || 0 }}</span>
                      </td>
                      <td>
                        <span class="badge" [class.bg-success]="quiz.difficulty === 'easy'" 
                              [class.bg-warning]="quiz.difficulty === 'medium'"
                              [class.bg-danger]="quiz.difficulty === 'hard'">
                          {{ quiz.difficulty }}
                        </span>
                      </td>
                      <td>{{ quiz.createdAt | date:'short' }}</td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-outline-primary"
                            (click)="previewQuiz(quiz)"
                            title="Preview & Review"
                          >
                            <i class="fas fa-eye"></i> Preview
                          </button>
                          <button 
                            class="btn btn-sm btn-success"
                            (click)="validateQuiz(quiz)"
                            title="Validate for Practice Mode"
                          >
                            <i class="fas fa-check"></i> Validate
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-danger"
                            (click)="deleteQuiz(quiz)"
                            title="Reject & Delete"
                          >
                            <i class="fas fa-trash"></i> Reject
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Validated Quizzes Section -->
            <div class="mb-4">
              <h6 class="text-success">
                <i class="fas fa-check-circle me-2"></i>
                Validated Quizzes - Available in Practice Mode ({{ validatedQuizzes().length }})
              </h6>
              <div class="alert alert-success" *ngIf="validatedQuizzes().length > 0">
                <i class="fas fa-check-circle me-2"></i>
                These quizzes are validated and available for candidates to take in Practice Mode.
              </div>
              <div class="table-responsive" *ngIf="validatedQuizzes().length > 0">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Topics</th>
                      <th>Questions</th>
                      <th>Difficulty</th>
                      <th>Validated Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let quiz of validatedQuizzes()">
                      <td>
                        <div class="d-flex align-items-center">
                          <i class="fas fa-check-circle text-success me-2"></i>
                          {{ quiz.title }}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-secondary">{{ quiz.category }}</span>
                      </td>
                      <td>
                        <span class="badge bg-info">{{ quiz.questions?.length || 0 }}</span>
                      </td>
                      <td>
                        <span class="badge" [class.bg-success]="quiz.difficulty === 'easy'" 
                              [class.bg-warning]="quiz.difficulty === 'medium'"
                              [class.bg-danger]="quiz.difficulty === 'hard'">
                          {{ quiz.difficulty }}
                        </span>
                      </td>
                      <td>{{ quiz.validatedAt | date:'short' }}</td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-outline-primary"
                            (click)="previewQuiz(quiz)"
                            title="View Quiz"
                          >
                            <i class="fas fa-eye"></i> View
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-warning"
                            (click)="invalidateQuiz(quiz)"
                            title="Remove from Practice Mode"
                          >
                            <i class="fas fa-times"></i> Invalidate
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="text-center py-4" *ngIf="validatedQuizzes().length === 0">
                <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                <p class="text-muted">No validated quizzes yet. Start by generating and validating quizzes from the AI Generator.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'dashboard'">
    <div class="row">
      <!-- Statistics Cards -->
      <div class="col-md-3 mb-4">
        <div class="stat-card quiz-stats">
          <div class="stat-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats().totalQuizzes }}</h3>
            <p>Total Quizzes</p>
            <small>{{ stats().validatedQuizzes }} validated, {{ stats().pendingQuizzes }} pending</small>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-4">
        <div class="stat-card question-stats">
          <div class="stat-icon">
            <i class="fas fa-question"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats().totalQuestions }}</h3>
            <p>Total Questions</p>
            <small>{{ stats().validatedQuestions }} validated, {{ stats().pendingQuestions }} pending</small>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-4">
        <div class="stat-card ai-stats">
          <div class="stat-icon">
            <i class="fas fa-robot"></i>
          </div>
          <div class="stat-content">
            <h3>{{ stats().aiGeneratedQuizzes }}</h3>
            <p>AI Generated</p>
            <small>{{ stats().manuallyCreatedQuizzes }} manually created</small>
          </div>
        </div>
      </div>

      <div class="col-md-3 mb-4">
        <div class="stat-card validation-stats">
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ ((stats().validatedQuizzes + stats().validatedQuestions) / (stats().totalQuizzes + stats().totalQuestions) * 100) | number:'1.1-1' }}%</h3>
            <p>Validation Rate</p>
            <small>Content validation status</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-bolt me-2"></i>
              Quick Actions
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-3">
                <button 
                  class="btn btn-primary btn-lg w-100 mb-3"
                  (click)="showQuestionForm.set(true)"
                >
                  <i class="fas fa-plus me-2"></i>
                  Add New Question
                </button>
              </div>
              <div class="col-md-3">
                <button 
                  class="btn btn-success btn-lg w-100 mb-3"
                  [routerLink]="['/quizzes/create']"
                >
                  <i class="fas fa-plus me-2"></i>
                  Create New Quiz
                </button>
              </div>
              <div class="col-md-3">
                <button 
                  class="btn btn-warning btn-lg w-100 mb-3"
                  (click)="switchTab('quizzes')"
                >
                  <i class="fas fa-clock me-2"></i>
                  Review Pending ({{ stats().pendingQuizzes }})
                </button>
              </div>
              <div class="col-md-3">
                <button 
                  class="btn btn-info btn-lg w-100 mb-3"
                  [routerLink]="['/quizzes/question-bank']"
                >
                  <i class="fas fa-database me-2"></i>
                  Manage Question Bank
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quiz Management Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'quizzes'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-question-circle me-2"></i>
              Quiz Management
            </h5>
          </div>
          <div class="card-body">
            <!-- Pending Quizzes -->
            <div class="mb-4" *ngIf="pendingQuizzes().length > 0">
              <h6 class="text-warning">
                <i class="fas fa-clock me-2"></i>
                Pending Validation ({{ pendingQuizzes().length }})
              </h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Type</th>
                      <th>Questions</th>
                      <th>Difficulty</th>
                      <th>Created</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let quiz of pendingQuizzes()">
                      <td>
                        <div class="d-flex align-items-center">
                          <i [class]="getQuizTypeIcon(quiz)" class="me-2"></i>
                          {{ quiz.title }}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-secondary">{{ quiz.category }}</span>
                      </td>
                      <td>{{ quiz.questions.length || 0 }}</td>
                      <td>
                        <span class="badge" [class.bg-success]="quiz.difficulty === 'easy'" 
                              [class.bg-warning]="quiz.difficulty === 'medium'"
                              [class.bg-danger]="quiz.difficulty === 'hard'">
                          {{ quiz.difficulty }}
                        </span>
                      </td>
                      <td>{{ quiz.estimatedTime || 30 }} min</td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-outline-primary"
                            (click)="previewQuiz(quiz)"
                            title="Preview"
                          >
                            <i class="fas fa-eye"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-success"
                            (click)="validateQuiz(quiz)"
                            title="Validate"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-warning"
                            (click)="editQuiz(quiz)"
                            title="Edit"
                          >
                            <i class="fas fa-edit"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-danger"
                            (click)="deleteQuiz(quiz)"
                            title="Delete"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Validated Quizzes -->
            <div class="mb-4">
              <h6 class="text-success">
                <i class="fas fa-check-circle me-2"></i>
                Validated Quizzes ({{ validatedQuizzes().length }})
              </h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Type</th>
                      <th>Questions</th>
                      <th>Difficulty</th>
                      <th>Validated By</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let quiz of validatedQuizzes()">
                      <td>
                        <div class="d-flex align-items-center">
                          <i [class]="getQuizTypeIcon(quiz)" class="me-2"></i>
                          {{ quiz.title }}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-secondary">{{ quiz.category }}</span>
                      </td>
                      <td>{{ quiz.questions.length || 0 }}</td>
                      <td>
                        <span class="badge" [class.bg-success]="quiz.difficulty === 'easy'" 
                              [class.bg-warning]="quiz.difficulty === 'medium'"
                              [class.bg-danger]="quiz.difficulty === 'hard'">
                          {{ quiz.difficulty }}
                        </span>
                      </td>
                      <td>{{ quiz.validatedBy || 'System' }}</td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-outline-primary"
                            (click)="previewQuiz(quiz)"
                            title="View"
                          >
                            <i class="fas fa-eye"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-warning"
                            (click)="editQuiz(quiz)"
                            title="Edit"
                          >
                            <i class="fas fa-edit"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-danger"
                            (click)="deleteQuiz(quiz)"
                            title="Delete"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Question Bank Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'questions'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">
                <i class="fas fa-database me-2"></i>
                Question Bank Management
              </h5>
              <button 
                class="btn btn-primary"
                (click)="openQuestionForm()"
              >
                <i class="fas fa-plus me-2"></i>
                Add New Question
              </button>
            </div>
          </div>
          <div class="card-body">
            <!-- Pending Questions -->
            <div class="mb-4" *ngIf="pendingQuestions().length > 0">
              <h6 class="text-warning">
                <i class="fas fa-clock me-2"></i>
                Pending Validation ({{ pendingQuestions().length }})
              </h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Question</th>
                      <th>Type</th>
                      <th>Language</th>
                      <th>Difficulty</th>
                      <th>Tags</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let question of pendingQuestions()">
                      <td>
                        <div class="question-preview">
                          {{ question.text.substring(0, 80) }}{{ question.text.length > 80 ? '...' : '' }}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-info">{{ question.type }}</span>
                      </td>
                      <td>{{ question.language }}</td>
                      <td>
                        <span class="badge" [class.bg-success]="question.difficulty === 'easy'" 
                              [class.bg-warning]="question.difficulty === 'medium'"
                              [class.bg-danger]="question.difficulty === 'hard'">
                          {{ question.difficulty }}
                        </span>
                      </td>
                      <td>
                        <span 
                          *ngFor="let tag of question.tags" 
                          class="badge bg-secondary me-1"
                        >
                          {{ tag }}
                        </span>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-outline-success"
                            (click)="validateQuestion(question)"
                            title="Validate"
                          >
                            <i class="fas fa-check"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-danger"
                            (click)="deleteQuestion(question)"
                            title="Delete"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Validated Questions -->
            <div class="mb-4">
              <h6 class="text-success">
                <i class="fas fa-check-circle me-2"></i>
                Validated Questions ({{ validatedQuestions().length }})
              </h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Question</th>
                      <th>Type</th>
                      <th>Language</th>
                      <th>Difficulty</th>
                      <th>Tags</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let question of validatedQuestions()">
                      <td>
                        <div class="question-preview">
                          {{ question.text.substring(0, 80) }}{{ question.text.length > 80 ? '...' : '' }}
                        </div>
                      </td>
                      <td>
                        <span class="badge bg-info">{{ question.type }}</span>
                      </td>
                      <td>{{ question.language }}</td>
                      <td>
                        <span class="badge" [class.bg-success]="question.difficulty === 'easy'" 
                              [class.bg-warning]="question.difficulty === 'medium'"
                              [class.bg-danger]="question.difficulty === 'hard'">
                          {{ question.difficulty }}
                        </span>
                      </td>
                      <td>
                        <span 
                          *ngFor="let tag of question.tags" 
                          class="badge bg-secondary me-1"
                        >
                          {{ tag }}
                        </span>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-outline-warning"
                            title="Edit"
                          >
                            <i class="fas fa-edit"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-danger"
                            (click)="deleteQuestion(question)"
                            title="Delete"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Candidates Management Tab -->
    <!-- Candidates Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'candidates'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h5 class="card-title mb-0">
                  <i class="fas fa-users me-2"></i>
                  Candidate Management & Testing
                </h5>
                <p class="text-muted mb-0">Manage candidates and assign appropriate quizzes based on their skill level</p>
              </div>
              <button 
                class="btn btn-primary"
                (click)="openCandidateForm()"
              >
                <i class="fas fa-user-plus me-2"></i>
                Add New Candidate
              </button>
            </div>
          </div>
          <div class="card-body">
            <!-- Candidate Level Distribution Stats -->
            <div class="row mb-4">
              <div class="col-md-3">
                <div class="stat-card beginner-stats">
                  <div class="stat-icon">
                    <i class="fas fa-seedling"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getCandidatesByLevel('beginner').length }}</h3>
                    <p>Beginner Level</p>
                    <small>Entry-level candidates</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card intermediate-stats">
                  <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getCandidatesByLevel('intermediate').length }}</h3>
                    <p>Intermediate Level</p>
                    <small>Mid-level candidates</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card advanced-stats">
                  <div class="stat-icon">
                    <i class="fas fa-trophy"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getCandidatesByLevel('advanced').length }}</h3>
                    <p>Advanced Level</p>
                    <small>Senior-level candidates</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card completion-stats">
                  <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ candidateStats().completedTests }}</h3>
                    <p>Tests Completed</p>
                    <small>Total completed assessments</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Active Candidates Table -->
            <div class="mb-4">
              <h6 class="text-primary">
                <i class="fas fa-users me-2"></i>
                Active Candidates ({{ allCandidates().length }})
              </h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Candidate</th>
                      <th>Level</th>
                      <th>Technology</th>
                      <th>Test Status</th>
                      <th>Assigned Quiz</th>
                      <th>Score</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let candidate of allCandidates()">
                      <td>
                        <div class="d-flex align-items-center">
                          <div class="candidate-avatar me-3">
                            <i class="fas fa-user-circle fa-2x text-muted"></i>
                          </div>
                          <div>
                            <strong>{{ candidate.firstName }} {{ candidate.lastName }}</strong>
                            <br>
                            <small class="text-muted">{{ candidate.email }}</small>
                          </div>
                        </div>
                      </td>
                      <td>
                        <span class="badge" 
                              [class.bg-success]="candidate.skillLevel === 'beginner'"
                              [class.bg-warning]="candidate.skillLevel === 'intermediate'"
                              [class.bg-danger]="candidate.skillLevel === 'advanced'">
                          {{ candidate.skillLevel | titlecase }}
                        </span>
                      </td>
                      <td>
                        <span class="badge bg-secondary">{{ candidate.primaryTechnology || 'Not Set' }}</span>
                      </td>
                      <td>
                        <span class="badge" 
                              [class.bg-secondary]="candidate.testStatus === 'not_started'"
                              [class.bg-primary]="candidate.testStatus === 'in_progress'"
                              [class.bg-success]="candidate.testStatus === 'completed'"
                              [class.bg-danger]="candidate.testStatus === 'expired'">
                          {{ getTestStatusLabel(candidate.testStatus) }}
                        </span>
                      </td>
                      <td>
                        <div *ngIf="candidate.assignedQuizId; else noQuizAssigned">
                          <i class="fas fa-clipboard-list text-primary me-1"></i>
                          <small>Quiz assigned</small>
                        </div>
                        <ng-template #noQuizAssigned>
                          <span class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            No quiz assigned
                          </span>
                        </ng-template>
                      </td>
                      <td>
                        <div *ngIf="candidate.lastTestScore !== null && candidate.lastTestScore !== undefined; else noScore">
                          <span class="badge" 
                                [class.bg-success]="candidate.lastTestScore >= 70"
                                [class.bg-warning]="candidate.lastTestScore >= 50 && candidate.lastTestScore < 70"
                                [class.bg-danger]="candidate.lastTestScore < 50">
                            {{ candidate.lastTestScore }}%
                          </span>
                        </div>
                        <ng-template #noScore>
                          <span class="text-muted">Not tested</span>
                        </ng-template>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <button 
                            class="btn btn-sm btn-primary"
                            (click)="assignSmartQuiz(candidate)"
                            title="Auto-assign appropriate quiz"
                            [disabled]="candidate.testStatus === 'completed' || !hasValidatedQuizzesForLevel(candidate.skillLevel)"
                          >
                            <i class="fas fa-brain"></i> Smart Assign
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-info"
                            (click)="viewCandidateDetails(candidate)"
                            title="View detailed profile"
                          >
                            <i class="fas fa-eye"></i>
                          </button>
                          <button 
                            class="btn btn-sm btn-outline-warning"
                            (click)="editCandidate(candidate)"
                            title="Edit candidate information"
                          >
                            <i class="fas fa-edit"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Recent Test Results -->
            <div class="mb-4" *ngIf="candidateStats().recentResults.length > 0">
              <h6 class="text-success">
                <i class="fas fa-chart-bar me-2"></i>
                Recent Test Results (Last 7 days)
              </h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Candidate</th>
                      <th>Quiz</th>
                      <th>Score</th>
                      <th>Grade</th>
                      <th>Duration</th>
                      <th>Recommendation</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let result of candidateStats().recentResults">
                      <td>{{ result.candidateName }}</td>
                      <td>{{ result.quizTitle }}</td>
                      <td>
                        <span class="badge" 
                              [class.bg-success]="result.percentageScore >= 70"
                              [class.bg-warning]="result.percentageScore >= 50 && result.percentageScore < 70"
                              [class.bg-danger]="result.percentageScore < 50">
                          {{ result.percentageScore | number:'1.1-1' }}%
                        </span>
                      </td>
                      <td>
                        <span class="badge" [class]="'bg-' + getGradeColor(result.grade)">
                          {{ result.grade }}
                        </span>
                      </td>
                      <td>{{ result.actualDurationMinutes }} min</td>
                      <td>
                        <span class="badge" [class]="'bg-' + getRecommendationColor(result.hiringRecommendation)">
                          {{ getRecommendationLabel(result.hiringRecommendation) }}
                        </span>
                      </td>
                      <td>{{ result.completedAt | date:'short' }}</td>
                      <td>
                        <button 
                          class="btn btn-sm btn-outline-primary"
                          (click)="viewDetailedResults(result)"
                          title="View detailed results"
                        >
                          <i class="fas fa-chart-line"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="text-center py-4" *ngIf="allCandidates().length === 0">
              <i class="fas fa-users fa-3x text-muted mb-3"></i>
              <p class="text-muted">No candidates registered yet. Add your first candidate to start the assessment process.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'analytics'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-chart-bar me-2"></i>
              Analytics & Insights
            </h5>
            <p class="text-muted mb-0">Comprehensive analytics on quiz performance and candidate assessments</p>
          </div>
          <div class="card-body">
            <!-- Performance Metrics -->
            <div class="row mb-4">
              <div class="col-md-3">
                <div class="stat-card performance-stats">
                  <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ candidateStats().averageScore | number:'1.1-1' }}%</h3>
                    <p>Average Score</p>
                    <small>Across all completed tests</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card completion-stats">
                  <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getAverageCompletionTime() }} min</h3>
                    <p>Avg. Completion Time</p>
                    <small>Average time to complete tests</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card hiring-stats">
                  <div class="stat-icon">
                    <i class="fas fa-thumbs-up"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getHiringRecommendationRate() }}%</h3>
                    <p>Hiring Rate</p>
                    <small>Candidates recommended for hiring</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="stat-card quiz-stats">
                  <div class="stat-icon">
                    <i class="fas fa-clipboard-list"></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ stats().validatedQuizzes }}</h3>
                    <p>Active Quizzes</p>
                    <small>Available for candidate testing</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quiz Performance Analysis -->
            <div class="mb-4">
              <h6 class="text-primary">
                <i class="fas fa-chart-pie me-2"></i>
                Quiz Performance Analysis
              </h6>
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Analyze which quizzes are most effective for candidate assessment and identify areas for improvement.
              </div>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Quiz Title</th>
                      <th>Times Taken</th>
                      <th>Average Score</th>
                      <th>Pass Rate</th>
                      <th>Difficulty Rating</th>
                      <th>Effectiveness</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let quizStat of getQuizStatistics()">
                      <td>{{ quizStat.title }}</td>
                      <td>
                        <span class="badge bg-primary">{{ quizStat.timesTaken }}</span>
                      </td>
                      <td>
                        <span class="badge" 
                              [class.bg-success]="quizStat.averageScore >= 70"
                              [class.bg-warning]="quizStat.averageScore >= 50 && quizStat.averageScore < 70"
                              [class.bg-danger]="quizStat.averageScore < 50">
                          {{ quizStat.averageScore | number:'1.1-1' }}%
                        </span>
                      </td>
                      <td>
                        <span class="badge" 
                              [class.bg-success]="quizStat.passRate >= 60"
                              [class.bg-warning]="quizStat.passRate >= 40 && quizStat.passRate < 60"
                              [class.bg-danger]="quizStat.passRate < 40">
                          {{ quizStat.passRate | number:'1.1-1' }}%
                        </span>
                      </td>
                      <td>
                        <span class="badge" 
                              [class.bg-success]="quizStat.difficulty === 'easy'"
                              [class.bg-warning]="quizStat.difficulty === 'medium'"
                              [class.bg-danger]="quizStat.difficulty === 'hard'">
                          {{ quizStat.difficulty | titlecase }}
                        </span>
                      </td>
                      <td>
                        <div class="progress" style="height: 20px;">
                          <div class="progress-bar" 
                               [class.bg-success]="quizStat.effectiveness >= 80"
                               [class.bg-warning]="quizStat.effectiveness >= 60 && quizStat.effectiveness < 80"
                               [class.bg-danger]="quizStat.effectiveness < 60"
                               [style.width.%]="quizStat.effectiveness">
                            {{ quizStat.effectiveness | number:'1.0-0' }}%
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Tab -->
  <div class="container-fluid mt-4" *ngIf="currentTab() === 'settings'">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-cog me-2"></i>
              System Settings
            </h5>
          </div>
          <div class="card-body">
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              System settings will be implemented in future versions.
            </div>
            <div class="row">
              <div class="col-md-6">
                <h6>AI Configuration</h6>
                <p>Configure AI quiz generation parameters, API keys, and model settings.</p>
              </div>
              <div class="col-md-6">
                <h6>Validation Rules</h6>
                <p>Set up automatic validation rules and expert reviewer assignments.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Question Form Modal -->
<app-question-form 
  *ngIf="showQuestionForm()"
  [question]="editingQuestion()"
  (questionSaved)="onQuestionSaved($event)"
  (formClosed)="closeQuestionForm()"
></app-question-form>

<!-- Quiz Preview Modal -->
<app-quiz-preview-modal
  *ngIf="showQuizPreview()"
  [quiz]="previewingQuiz()"
  (closed)="closeQuizPreview()"
  (quizValidated)="onQuizValidated($event)"
  (quizEditRequested)="onQuizEditRequested($event)"
></app-quiz-preview-modal>