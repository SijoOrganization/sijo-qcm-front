<div class="container mt-3">
  <!-- Header Section -->
  @if (isEditing) {
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="m-0">Edit Quiz</h3>
      <div>
        <button class="btn btn-primary" (click)="reset()">Reset</button>
      </div>
    </div>
  } @else {
    <h3>Create new quiz</h3>
  }

  @if (!!quiz()) {
    <!-- Quiz Metadata Form -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="fas fa-edit me-2"></i>
          Quiz Information
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="quizTitle" class="form-label">Quiz Title *</label>
              <input
                type="text"
                class="form-control"
                id="quizTitle"
                [(ngModel)]="quiz().title"
                placeholder="Enter quiz title"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="quizDifficulty" class="form-label">Difficulty *</label>
              <select
                class="form-select"
                id="quizDifficulty"
                [(ngModel)]="quiz().difficulty"
              >
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
                <option value="mixed">Mixed</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="quizCategory" class="form-label">Category</label>
              <input
                type="text"
                class="form-control"
                id="quizCategory"
                [(ngModel)]="quiz().category"
                placeholder="e.g., Programming, Web Development"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="estimatedTime" class="form-label"
                >Estimated Time (minutes)</label
              >
              <input
                type="number"
                class="form-control"
                id="estimatedTime"
                [(ngModel)]="quiz().estimatedTime"
                min="1"
                placeholder="30"
              />
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="quizExplanation" class="form-label">Description</label>
          <textarea
            class="form-control"
            id="quizExplanation"
            rows="3"
            [(ngModel)]="quiz().explanation"
            placeholder="Brief description of the quiz content..."
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Nav Tabs -->
    <ul
      ngbNav
      #nav="ngbNav"
      class="nav nav-tabs"
      [(activeId)]="active"
      (navChange)="onTabChange($event)"
    >
      <li [ngbNavItem]="1">
        <a ngbNavLink>Form Input</a>
        <ng-template ngbNavContent>
          <!-- Form to input quiz details -->
          <app-quiz-form
            [(quiz)]="quiz"
            [isEditing]="isEditing"
          ></app-quiz-form>
          <!-- Footer Buttons -->
          <div class="d-flex justify-content-end mt-4">
            @if (isEditing) {
              <button class="btn btn-outline-danger me-2" (click)="delete()">
                Delete Quiz
              </button>
              <button class="btn btn-success" (click)="save()">Save</button>
            } @else {
              <button class="btn btn-success" (click)="create()">
                Create quiz
              </button>
            }
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="2">
        <a ngbNavLink>JSON Editor</a>
        <ng-template ngbNavContent>
          <div class="editor-container">
            <ngx-monaco-editor
              class="json-editor"
              [(ngModel)]="jsonQuiz"
              [options]="editorOptions"
              aria-label="JSON Quiz Editor"
            ></ngx-monaco-editor>
          </div>
          <button class="mt-3 btn btn-primary" (click)="checkJson()">
            Check JSON
          </button>
        </ng-template>
      </li>
      @if (!isEditing) {
        <li [ngbNavItem]="3">
          <a ngbNavLink>AI generator</a>

          <ng-template ngbNavContent>
            <form (ngSubmit)="generateQuiz(topics.value, nbQuestions.value)">
              <div class="form-group">
                <label for="topics">This quiz is about...</label>
                <input
                  type="text"
                  class="form-control"
                  id="topics"
                  aria-describedby="topics"
                  placeholder="Quiz topics"
                  value="Java,Python"
                  #topics
                />
              </div>
              <div class="form-group">
                <label for="nbQuestions">Number of questions</label>
                <input
                  type="number"
                  class="form-control"
                  id="nbQuestions"
                  placeholder="nbQuestions"
                  value="5"
                  #nbQuestions
                />
              </div>
              <button type="submit" class="btn btn-primary mt-3">
                Generate
              </button>
            </form>
          </ng-template>
        </li>
      }
    </ul>

    <!-- Render Tabs -->
    <div [ngbNavOutlet]="nav" class="mt-3"></div>
  }
</div>
